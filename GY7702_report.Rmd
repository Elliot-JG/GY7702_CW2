---
title: "GY7702_CW2"
author: "209040725"
date: "21/12/2020"
output:
  rmarkdown::pdf_document:
urlcolor: blue
---

This document was created to meet the requirements of GY7702 R for Data 
Science at University of Leicester. It was designed and created in R Markdown, a 
markup language that allows users to create documents that can be formatted to embed code blocks, code outputs and hyperlinks.
When the R Markdown file is compiled, the markup language is hidden and the document is displayed in plain text.

This content was created using [R](https://www.r-project.org/), [Rstudio](https://rstudio.com/), [RMarkdown](https://rmarkdown.rstudio.com/) and [GitHub](https://github.com/)


The libraries used in this assignment were 
```{r load_libraries, warning=FALSE, message=FALSE}
library(tidyverse)
library(pastecs)
library(knitr)
library(tinytex)
library(kableExtra)
library(gridExtra)
library(psych)
```

# Load in the data 

```{r, message=FALSE, warning = FALSE}

# Extract 
unzip("Data/GY7702_2020-21_Assignment_2--data_pack.zip", exdir = "Data")

# Load
OAC_2011 <- 
  readr::read_csv(
    "Data/GY7702_2020-21_Assignment_2--data_pack/2011_OAC_Raw_kVariables.csv")

OAC_2011_meta <- 
  readr::read_csv(
    "Data/GY7702_2020-21_Assignment_2--data_pack/OA11_LSOA11_MSOA11_LAD11_EW_LUv2.csv")


```


# Option A 

## Joining the data sets

```{r, message = FALSE}
# Rename the column 'OA11CD' to OA so it matches the same column in OAC_2011 
OAC_2011_meta <- OAC_2011_meta %>% 
  dplyr::rename(
    OA = OA11CD
  )

# Join OAC_2011 with OAC_2011_meta, based on the OA column for each data frame 
complete_OAC <- 
  OAC_2011 %>%
  dplyr::left_join(.,OAC_2011_meta)
```

## Subsetting 
* Selecting assigned LAD
* Selecting the appropriate variables
  + k004 Persons aged 45 to 64
  + k009 Persons aged over 16 who are single
  + k010 Persons aged over 16 who are married or in a registered same-sex civil partnership
  + k027 Households who live in a detached house or bungalow
  + k031 Households who own or have shared ownership of property
  + k041 Households with two or more cars or vans
  + k046 Employed persons aged between 16 and 74 who work part-time

```{r}
# Subset data based off LAD11NM = Wellingborough
wellingborough <- complete_OAC %>%
  dplyr::filter(LAD11NM == "Wellingborough")

# Select the appropriate variables, based on their 'VariableCode' 
wellingborough_variables <- wellingborough %>%
  dplyr::select(k004, k009, k010, k027, k031, k041, k046)
```

# Question A.1 
Word count (excluding titles = 497)

## Exploring the distribution of Employed persons aged between 16 and 74 who work part-time

The distribution of part-time employed persons (PTEP) throughout 249 output areas (OA's) in the Local Area District (LAD) of Wellingborough was investigated.

#### Basic histogram for visual histogram 
```{r fig.align="center"}
k046_hist <- wellingborough %>%
  ggplot2::ggplot(aes(
    x = k046))+
  ggplot2::geom_bar()+
  scale_x_binned(
    n.breaks = 5)+
  xlab("Employed persons (16-74 years old) working part-time")+
  ylab("Frequency")+
  geom_vline(aes(
    xintercept = mean(k046)), 
    colour="red", 
    lwd = 1.5)+
  theme_gray(
    base_size = 15)

print(k046_hist)
```
An initial assessment suggests that the distribution of PTEPs throughout Wellingborough is normal. The majority of OA's in Welingborough have 35-45 PTEPS with some having as little as 20 and at least one having >80 PTEPs. A red line also demonstrates the average number of PTEPs per OA (38)



#### Plotting against normal distribution

The distribution can be further assessed using ```stat_qq``` . This demonstrates where values may lie in the observed data that are affecting the normal distribution. 
```{r}
wellingborough %>%
  ggplot2::ggplot(aes(
    sample = k046))+
  ggplot2::stat_qq()+
  ggplot2::stat_qq_line(
    aes(
      colour = "normal distribution"), 
    show.legend = TRUE, 
    lwd = 1)+
  xlab("Theoretical normal distribution")+
  ylab("Observed value")+
  theme_gray(
    base_size = 15) 

```
There are an elevated number of PTEPs at the tails of the distribution. That is, a considerable number of OA's have a minimum and maximum number of PTEPs.    

#### Shapiro-Wilk test 

Using a Shapiro-Wilk test we can investigate further if this a normal distribution. 
```{r}
  k046 <- wellingborough %>%
  dplyr::pull(k046)%>%
 stats::shapiro.test()

kable(k046[2], format = "latex", booktabs = T) %>%
kable_styling(latex_options = c("striped", "scale_up"))

```

In the Shapiro-Wilk test, a null hypothesis that the data is normally distributed is set. This is rejected if the p-value <0.01. That is, there is a <1% chance of the data being normally distributed. In this case p < 0.01, so the data is not normally distributed. 

#### Exploring skewness and kurtosis 

The overall shape of the data can be assessed further using ***skewness*** and ***kurtosis***
```{r}
wellingborough_skew <- 
  wellingborough %>%
    dplyr::select(k046)%>%
    pastecs::stat.desc(basic = FALSE, 
                       desc = FALSE, 
                       norm = TRUE)
  
kable(wellingborough_skew, format = "latex", booktabs = T) %>%
kable_styling(latex_options = c("striped", "scale_up"))
```

A positive skew means the data leans left. The standard error for the skew ```skew.2SE``` lies outside of the range -1 + 1, meaning the result is significant. A positive kurtosis also means the data has heavy tails. However, this result is not significant as ```kurt.2SE``` lies within -1 +1



## Multi-variate analysis 

We have just carried out a uni-variate analysis. Relationships between variables can be assessed through multivariate analysis. 
The variables used in this study are split between collecting data on ***persons*** and ***households***. We can use a ```pairs.panel``` to compare these sets of data and discover correlations. 
The data here is not normally distributed (except k010), hence we will use ```kendall_tau``` which assumes a non-normal distribution and ties. 

```{r}
wellingborough_norm <- 
  wellingborough_variables %>%
  dplyr::select(k004, k009, k027, k031, k041, k046, k010) %>%
  pastecs::stat.desc(norm = TRUE) 

kable(wellingborough_norm[19:20, ], format = "latex", booktabs = T) %>%
kable_styling(latex_options = c("striped", "scale_up"))
```

```{r}
wellingborough_variables %>%
  select(k004, k009, k027, k031, k041, k046, k010)%>%
  pairs.panels(method = "kendall", 
               stars = TRUE)
```
k010 has a strong correlation with k031 and k041. This is understandable. People who have shared ownership of a property will usually (but not always) be in a relationship and may also own a car. k009 does not reasonably correlate with any other variable, possibly for the opposite reasons.


#### Normalising data 

The amount of people in a relationship (k010) and the amount of households with shared ownership (k031) is highly correlated (0.73). However, k031 gives information on ***households*** while k010 gives information on ***persons***. To aid comparison of the data sets, the z-scores can be taken.
```{r}
wellingborough_variables <- 
  wellingborough_variables %>%
    mutate(z_k031 = scale(k031)) %>%
    mutate(z_k010 = scale(k010))
```

Note, though that z scores conserve the distribution of the data sets. This means that a Shapiro-Wilks test will still fail for k031

```{r}
wellingborough_variables %>%
  dplyr::select(z_k031, z_k010)%>%
  pastecs::stat.desc(norm = TRUE)
```

This assessment should not usually be carried out on non-normally distributed data. However, for the purpose of this study the new plot of z-scores offers more exploratory analysis. Values on either axis that are close to 0 are close to the mean. OA's that have the average number of people >16 in a relationship, also have the average number of households with shared ownership. 


```{r}
ggplot2::ggplot(
  wellingborough_variables, 
    aes(z_k031, 
        z_k010)
  )+
  ggplot2::geom_point()+
  xlab("households with shared ownership")+
  ylab("Persons >16 in a relationship")
```




    

